<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>LOBE- COMPARATIVE ANALYSIS RESULTS</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"><!--bootstrap file-->
	<link rel="stylesheet" type="text/css" href="css/style.css"><!--Css file-->
	<link rel="stylesheet" type="text/css" href="css/all.min.css"><!--Css file-->
	<link rel="stylesheet" type="text/css" href="css/responsive.css"><!--Css file-->
</head>
<body>
	<section class="dashboard-body">
		<div class="container-fluid">
			<div class="row heading">
				<div class="col-sm-3"></div>
				<div class="col-sm-8">
					<h5>LEARNING OBJECT EVALUATION TOOL</h5>
				</div>
				<div class="col-sm-1 go-bck-btn">
					<a href="analytics-panel.html">Go Back</a>
				</div>
			</div>
			<div class="row">
				<!-- Side Panel -->
				<div class="col-sm-3 dashboard-panel">
					<div class="row">
						<div class="col-sm-12">
							<img src="imgs/Ellipse.png">
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<h4 id="dash-name"></h4>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<a href="javascript:void(0)" class="disabled-btn">View Analysis</a>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<a href="settings.html">Settings</a>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<a href="" id="logout">Logout</a>
						</div>
					</div>
				</div>
				<!-- Main Content body -->
				<div class="col-sm-9 result-panel comp-form-results">
					<div class="row new-comp">
						<!-- Detailed Score -->
						<h4>Comparative Analysis</h4>
						<span class="legend-span">LEGEND :</span>
						<div class="col-sm-12 new-comp-cnt">
							<div class="row">
								<div class="col-sm-2 zero">
									<a href="javascript:void(0)" class="zero-link" id="zone-0">
										Non-significant remedial effort &nbsp;<span data-toggle="tooltip" title="You are very strong in">i</span>
									</a>
								</div>
								<div class="col-sm-2 zero" style="background-color: #008080;">
									<a href="javascript:void(0)" class="zero-link" id="zone-1">
										Minor remedial effort &nbsp;<span data-toggle="tooltip" title="You are very strong in">i</span>
									</a>
								</div>
								<div class="col-sm-2 moderate">
									<a href="javascript:void(0)" class="mode-link" id="zone-2">
										Moderate remedial effort &nbsp;<span data-toggle="tooltip" title="You are strong in">i</span>
									</a>
								</div>

								<div class="col-sm-2 high">
									<a href="javascript:void(0)" class="high-link" id="zone-3">
										High remedial effort &nbsp;<span data-toggle="tooltip" title="You are weak in">i</span>
									</a>
								</div>

								<div class="col-sm-2 danger">
									<a href="javascript:void(0)" class="dang-link" id="zone-4">
										Danger Zone &nbsp;<span data-toggle="tooltip" title="You are very weak in">i</span>
									</a>
								</div>
							</div>

							<!-- Content Table -->
							<div class="comp-table" id="comp-content">
								
							</div>

							<!-- Pedagogy table -->
							<div class="comp-table" id="comp-pedagogy">
								
							</div>

							<!-- Design table -->
							<div class="comp-table" id="comp-design">

							</div>

							<!-- Technological table -->
							<div class="comp-table" id="comp-techno">
								
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
</body>
<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script><!--JQuery file-->
<script type="text/javascript" src="js/jquery-ui.min.js"></script><!--Jquery UI File-->
<script type="text/javascript" src="js/umd/popper.min.js"></script><!--popper-->
<script type="text/javascript" src="js/bootstrap.min.js"></script><!--bootstrap-->
<script type="text/javascript" src="js/auth.js"></script>

<script type="text/javascript">
	$(document).ready(function () {
		$('[data-toggle="tooltip"]').tooltip();

		var user = runValidations();
		var accessToken = localStorage.getItem("accessToken");

		if(user.status!='ACTIVE'){
			window.location.replace("signup.html");
		}

		var type;
		if(user.roles.includes('evaluator')){
			type='evaluator';
			$('#dash-name').append('EVALUATOR DASHBOARD');
		}
		else{
			type='generator';
			$('#dash-name').append('GENERATOR DASHBOARD');
		}

		var url = new URL(window.location.href);
		var lobeIds = url.searchParams.get("lobeIds");

		$.ajax({
			type: 'GET',
			url: basePath+'/api/analytics/comparative-analysis?lobeIds='+lobeIds,
			dataType: 'json',
			async: false,
			headers : {
				'Authorization': 'Bearer '+accessToken,
			},
			success: function(response){

				var allRepos = [];
				var cData = [];
				var pData = [];
				var dData = [];
				var tData = [];

				var i=0;
				response.data.forEach(function(repoData){

					allRepos.push(repoData.repositoryName);

					repoData.cmpDimensions.forEach(function(dimension){

						var x=0;
						dimension.cmpQuestions.forEach(function(question){

							var dimensionName = dimension.dimensionName;

							if(dimensionName=='Content Quality'){
								if(i==0){
									cData[x]={};
									cData[x].zones=[];
								}
								cData[x].question=question.question;
								cData[x].zones.push(question.zone);
							}
							else if(dimensionName=='Pedagogical Alignment'){
								if(i==0){
									pData[x]={};
									pData[x].zones=[];
								}
								pData[x].question=question.question;
								pData[x].zones.push(question.zone);
							}
							else if(dimensionName=='Design Efficacy'){
								if(i==0){
									dData[x]={};
									dData[x].zones=[];
								}
								dData[x].question=question.question;
								dData[x].zones.push(question.zone);
							}
							else if(dimensionName=='Technological Integration'){
								if(i==0){
									tData[x]={};
									tData[x].zones=[];
								}
								tData[x].question=question.question;
								tData[x].zones.push(question.zone);
							}
							x++;
						});

					});
					i++;
				});

				appendDataToTable('CONTENT QUALITY', allRepos, cData, '#comp-content');

				appendDataToTable('PEDAGOGICAL ALIGNMENT', allRepos, pData, '#comp-pedagogy');

				appendDataToTable('DESIGN EFFICACY', allRepos, dData, '#comp-design');

				appendDataToTable('TECHNOLOGICAL INTEGRATION', allRepos, tData, '#comp-techno');
			}
		});
	});

	function appendDataToTable(title, allRepos, data, divId) {
		
		var html='';
		html+='<div class="comp-table" id="comp-content">';
		html+='<table class="table table-bordered">';
		html+='<thead>';
		html+='<tr>';
		html+='<th class="quality-company"><span>'+title+'</span></th>';
		allRepos.forEach(function(repo){
			html+='<th class="company-thead"><span>'+repo+'</span></th>';
		})
		html+='</tr>';
		html+='</thead>';
		html+='<tbody>';
		data.forEach(function(question){
			html+='<tr>';
			html+='<th><span>'+question.question+'</span></th>';
			question.zones.forEach(function(zone){
				html+='<th><div class="circle"><span class="';
				if(zone=='green'){
					html+='zero-circle';
				}
				else if(zone=='teal'){
					html+='teal-circle';
				}
				else if(zone=='yellow'){
					html+='moderate-circle';
				}
				else if(zone=='orange'){
					html+='high-circle';
				}
				else if(zone=='red'){
					html+='danger-circle';
				}
				html+='"></span></div></th>';
			});
			html+='</tr>';
		});
		html+='</tbody>';
		html+='</table>';
		html+='</div>';

		$(divId).append(html);
	}
</script>
</html>