<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>LOBE- STRENGTH WEAKNESS ANALYSIS RESULTS</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"><!--bootstrap file-->
	<link rel="stylesheet" type="text/css" href="css/style.css"><!--Css file-->
	<link rel="stylesheet" type="text/css" href="css/all.min.css"><!--Css file-->
	<link rel="stylesheet" type="text/css" href="css/responsive.css"><!--Css file-->
</head>
<body>
	<section class="dashboard-body">
		<div class="container-fluid">
			<div class="row heading">
				<div class="col-sm-3"></div>
				<div class="col-sm-7">
					<h5>LEARNING OBJECT EVALUATION TOOL</h5>
				</div>
				<div class="col-sm-1 go-bck-btn">
					<a href="javascript:void(0)" id="generate-pdf">Save as PDF</a>
				</div>
				<div class="col-sm-1 go-bck-btn">
					<a href="analytics-panel.html">Go Back</a>
				</div>
			</div>
			<div class="row">
				<!-- Side Panel -->
				<div class="col-sm-3 dashboard-panel">
					<div class="row">
						<div class="col-sm-12">
							<img src="imgs/Ellipse.png">
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<h4 id="dash-name"></h4>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<a href="javascript:void(0)" class="disabled-btn">View Analysis</a>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<a href="settings.html">Settings</a>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<a href="" id="logout">Logout</a>
						</div>
					</div>
				</div>
				<!-- Main Content body -->
				<div class="col-sm-9 result-panel sw-form-results" id="pdf-html">
					<div class="row new-sw">
						<!-- Detailed Score -->
						<h4 style="padding-left:17px">Strength Weakness Analysis</h4>
						<div class="col-sm-12 new-sw-cnt">
							<div class="row">
								<div class="col-sm-2 zero">
									<a href="javascript:void(0)" class="zero-link" id="zone-0">
										Non-significant remedial effort &nbsp;<span data-toggle="tooltip" title="You are very strong in">i</span>
									</a>
								</div>
								<div class="col-sm-2 zero" style="background-color: #008080;">
									<a href="javascript:void(0)" class="zero-link" id="zone-1">
										Minor remedial effort &nbsp;<span data-toggle="tooltip" title="You are very strong in">i</span>
									</a>
								</div>
								<div class="col-sm-2 moderate">
									<a href="javascript:void(0)" class="mode-link" id="zone-2">
										Moderate remedial effort &nbsp;<span data-toggle="tooltip" title="You are strong in">i</span>
									</a>
								</div>

								<div class="col-sm-2 high">
									<a href="javascript:void(0)" class="high-link" id="zone-3">
										High remedial effort &nbsp;<span data-toggle="tooltip" title="You are weak in">i</span>
									</a>
								</div>

								<div class="col-sm-2 danger">
									<a href="javascript:void(0)" class="dang-link" id="zone-4">
										Danger Zone &nbsp;<span data-toggle="tooltip" title="You are very weak in">i</span>
									</a>
								</div>
								<span><b>NOTE -</b> Click on the respective boxes to generate the analysis as per the remedial effort.</span>
							</div>

							<!-- Zero to minimal remedial effect TABLE -->
							<div class="zero-display" id="display-0">
								<h5>Non-significant remedial effort </h5>

							</div>

							<div class="zero-display" id="display-1">
								<h5 style="color: #008080">Minor remedial effort </h5>

							</div>

							<!-- Moderate remedial effect TABLE -->
							<div class="mode-display" id="display-2">
								<h5>Moderate remedial effort</h5>

							</div>

							<!-- High remedial effect TABLE -->
							<div class="high-display" id="display-3">
								<h5>High remedial effort</h5>

							</div>

							<!-- High remedial effect TABLE -->
							<div class="dang-display" id="display-4">
								<h5>Danger Zone</h5>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
</body>
<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script><!--JQuery file-->
<script type="text/javascript" src="js/jquery-ui.min.js"></script><!--Jquery UI File-->
<script type="text/javascript" src="js/umd/popper.min.js"></script><!--popper-->
<script type="text/javascript" src="js/bootstrap.min.js"></script><!--bootstrap-->
<script type="text/javascript" src="js/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js" integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/" crossorigin="anonymous"></script>

<script type="text/javascript" src="js/auth.js"></script>

<script type="text/javascript">
	$(document).ready(function () {
		$('[data-toggle="tooltip"]').tooltip();

		var user = runValidations();
		var accessToken = localStorage.getItem("accessToken");

		if(user.status!='ACTIVE'){
			window.location.replace("signup.html");
		}

		var type;
		if(user.roles.includes('evaluator')){
			type='evaluator';
			$('#dash-name').append('EVALUATOR DASHBOARD');
		}
		else{
			type='generator';
			$('#dash-name').append('GENERATOR DASHBOARD');
		}

		var url = new URL(window.location.href);
		var lobeIds = url.searchParams.get("lobeIds");

		$.ajax({
			type: 'GET',
			url: basePath+'/api/analytics/strength-weakness?lobeIds='+lobeIds,
			dataType: 'json',
			async: false,
			headers : {
				'Authorization': 'Bearer '+accessToken,
			},
			success: function(response){

				response.data.forEach(function(z){
					z.swDimensions.forEach(function(dimension){

						html='';
						if(dimension.swQuestions.length>0){

							html+='<table class="table table-bordered">';
							html+='<thead><tr><th class="quality-heading" colspan="5"><span>'+dimension.dimensionName+'</span></th></tr></thead>';
							html+='<thead><tr><th class="question-tb"><div class="score"><span>SCORE</span></div><div class="question"><span>QUESTION</span></div></th><th class="score-0"><span>Score 0</span><span>(Missing)</span></th><th class="score-1"><span>Score 1</span><span>(Inadequate)</span></th><th class="score-2"><span>Score 2</span>';
							html+='<span>(Almost)</span></th><th class="score-3"><span>Score 3</span><span>(Target)</span></th></tr></thead>';
							html+='<tbody>';
							dimension.swQuestions.forEach(function(q){
								html+='<tr>';
								html+='<th><span>'+q.question+'</span></th>';
								html+='<th><span>'+q.score0.toFixed(2)+'%</span></th>';
								html+='<th><span>'+q.score1.toFixed(2)+'%</span></th>';
								html+='<th><span>'+q.score2.toFixed(2)+'%</span></th>';
								html+='<th><span>'+q.score3.toFixed(2)+'%</span></th>';
								html+='</tr>';
							});
							html+='</tbody>';
							html+='</table>';
						}
						if(z.zone=='green'){
							$('#display-0').append(html);
						}
						else if(z.zone=='teal'){
							$('#display-1').append(html);
						}
						else if(z.zone=='yellow'){
							$('#display-2').append(html);
						}
						else if(z.zone=='orange'){
							$('#display-3').append(html);
						}
						else if(z.zone=='red'){
							$('#display-4').append(html);
						}
					});
				})
			}
		});

		$('#zone-0').click(function () {
			$('#display-0').show();
			$('#display-1, #display-2, #display-3, #display-4').hide();
		});

		$('#zone-1').click(function () {
			$('#display-1').show();
			$('#display-0, #display-2, #display-3, #display-4').hide();
		});

		$('#zone-2').click(function () {
			$('#display-2').show();
			$('#display-1, #display-0, #display-3, #display-4').hide();
		});

		$('#zone-3').click(function () {
			$('#display-3').show();
			$('#display-1, #display-2, #display-0, #display-4').hide();
		});

		$('#zone-4').click(function () {
			$('#display-4').show();
			$('#display-1, #display-2, #display-3, #display-0').hide();
		});

		$('#generate-pdf').click(function() {

		$('#display-0').show();
		$('#display-1').show();
		$('#display-2').show();
		$('#display-3').show();
		$('#display-4').show();

		html2canvas(document.querySelector("#pdf-html")).then(canvas => {

            try {
	            contentH = $('#pdf-html').height();
	            var img = canvas.toDataURL("image/png", 1.0);
	            $w = $actw = canvas.width;
	            $h = $acth = canvas.height;
	            var pdf = new jsPDF("p", "mm", "a4");
	            var width = $maxw = pdf.internal.pageSize.width;
	            var height = $maxh = pdf.internal.pageSize.height;
	            if (!$maxw) $maxw = width;
	            if (!$maxh) $maxh = height;
	            if ($w > $maxw) {
	                $w = $maxw;
	                $h = Math.round($acth / $actw * $maxw);
	            }
	            pdf.addImage(img, 'JPEG', 0, 0, $w, $h);
	            $count = Math.ceil($h) / Math.ceil($maxh);
	            $count = Math.ceil($count);
	            for (var i = 1; i < $count; i++) {
	                position = - $maxh * i
	                pdf.addPage(img, 'JPEG', 0, 0, $w, $h);
	                pdf.addImage(img, 'JPEG', 0, position, $w, $h);
	            }
	            pdf.save("strength-weakness-analysis.pdf");

	        } catch (e) {
	            alert("Error description: " + e.message);
	        }
		});
	    
	});
	});
</script>
</html>